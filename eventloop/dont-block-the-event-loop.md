## 요약
nodejs는 이벤트 루프와 작업자라는 두가지 유형의 스레드가 있다. 멀티 스레드를 사용하기 때문에 컨텍스트 변경에 따른 비용이 작지만 하나의 스레드가 전체 프로세스에 영향을 줄 수 있고 메모리를 공유하기 때문에 데이터 동기화에도 신경써야 한다. 이벤트 루프는 non-blocking i/o를 담당하고 작업자는 blocking i/o 및 cpu 집약적인 작업을 실행한다. 콜백이나 작업에 시간이 오래 걸리면 이를 실행하는 스레드는 blocking된다. 최악의 경우 서비스가 중단될 수 있다. 특히 이벤트루프의 경우 non-blocking으로 작동할 수 있도록 해야한다. 높은 처리량의 dos 방지 웹 서버를 작성하기 위해서 blocking되는지 안되는지 반드시 체크해야 한다.

<br>
nodejs는 이벤트 루프에서 js코드를 실행하고 파일 i/o와 같은 많은 연산을 요구하는 작업을 작업자 풀에서 처리한다.
nodejs의 확장성의 비결은 적은 수의 스레드를 사용해 많은 클라이언트를 처리한다는 것이다.
싱글 스레드로 작업했을 때의 이점은 컨텍스트 전환 비용이 감소한다는 것이다.
멀티 스레드 프로그램의 장점은 메모리를 바꿔줄 필요가 줄기 때문에 프로세스 전환시 발생하는 컨텍스트 전환 비용이 작다는 것이다. 하지만 메모리를 지속적으로 공유하고 하나의 프로세스에서 진행되기 때문에 하나의 스레드에서 에러가 발생하면 전체에 영향을 줄 수 있다. 또한 데이터를 공유하기 때문에 동기화에도 신경써야 한다.
또한 멀티 스레드이긴 하지만 스레드가 많지 않기 때문에 효율적으로 분산해 사용해야 한다.
nodejs에는 크게 두가지 유형의 스레트가 있다. 하나는 이벤트 루프, 하나는 작업자 풀이다.
스레드가 이벤트 루프의 콜백 또는 작업자풀의 작업을 실행하는데 오랜 시간이 걸리는 경우 이를 blocking 됐다고 한다.
blocking을 방지해야 하는 이유는 다음과 같다.<br>
1.성능 : 두가지 유형의 스레드에서 정기적으로 많은 작업을 수행하면 서버의 처리량이 저하된다.<br>
2.보안 : 특정 입력에 대해 스레드 중 하나가 차단될 수 있는 경우 악의적인 클라이언트가 악의적인 입력을 제출해 스레드를 차단하고 다른 클라이언트에서 작동하지 못하도록 할 수 있다.<br>

## eventloop
node 애플리케이션이 실행도면 모듈관련 코드를 실행하고 콜백을 등록하는 초기화 단계가 먼저 완료된다.
다음 ,node는 이벤트 루프에 들어가 적절한 콜백을 실행해 클라이언트 요청에 응답한다. 콜백은 동기식으로 실행된다.
이벤트 루프는 콜백에 의해 만들어진 비차단 비동기 요청을 수행한다. 
정리하면 이벤트 루프는 js의 콜백을 실행하고 네트워크 i/o와 같은 비차단 비동기 요청을 수행할 수 있다.

## libuv
nodejs는 작업자 풀을 사용하면 비싼 작업을 처리한다. 작업자풀은 많은 연산 작업을 처리한다. 
작업자 풀을 사용하는 nodejs 모듈 api는 다음과 같다.<br>
1.i/o집약적 : DNS, FILESYSTEM<br>
2.cpu집약적 : CRYPTO, ZLIB
 <br>
 https://nodejs.org/en/docs/guides/dont-block-the-event-loop/